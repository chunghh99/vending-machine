import{a as R}from"./chunk-3XWC6RHE.js";import{a as N}from"./chunk-NBDY2TBX.js";import{a as j}from"./chunk-DHM2ONHF.js";import{b as O}from"./chunk-EGJNLWBA.js";import{a as G}from"./chunk-OPDTKCI5.js";import{a as q}from"./chunk-G55IM4YV.js";import"./chunk-BKZFVQBW.js";import{a as P}from"./chunk-CI3TO52C.js";import{a as f}from"./chunk-ZJO5XFAT.js";import{c as M,d as S,e as B,f as w,k,n as V,r as F,s as U,u as L}from"./chunk-3AEYLFKI.js";import{a as D}from"./chunk-HNKJNLW6.js";import"./chunk-AFJOMKLS.js";import{b,d as I}from"./chunk-TN45MXFT.js";import"./chunk-4C57YJA5.js";import{Cb as _,Cc as x,Fb as y,Gb as p,Qa as c,Qb as m,Ra as v,Yb as T,kb as u,la as A,mb as s,ob as C,va as E,wa as g,wb as a,xb as r,yb as h}from"./chunk-ZFL4TBTD.js";import"./chunk-4L4RMVSS.js";function K(i,l){i&1&&(a(0,"h4"),m(1,"Thi\u1EBFt l\u1EADp thi\u1EBFt b\u1ECB"),r())}function Q(i,l){i&1&&(a(0,"h4"),m(1,"C\u1EADp nh\u1EADt thi\u1EBFt b\u1ECB"),r())}function W(i,l){i&1&&(a(0,"div",13),m(1," T\xEAn m\xE1y kh\xF4ng \u0111\u01B0\u1EE3c \u0111\u1EC3 tr\u1ED1ng. "),r())}function Y(i,l){if(i&1&&(a(0,"div"),u(1,W,2,0,"div",12),r()),i&2){let d=p();c(),s("ngIf",d.showError("name","required"))}}function Z(i,l){i&1&&(a(0,"div",13),m(1," \u0110\u1ECBa \u0111i\u1EC3m kh\xF4ng \u0111\u01B0\u1EE3c \u0111\u1EC3 tr\u1ED1ng. "),r())}function $(i,l){if(i&1&&(a(0,"div"),u(1,Z,2,0,"div",12),r()),i&2){let d=p();c(),s("ngIf",d.showError("location","required"))}}function ee(i,l){i&1&&(a(0,"div",13),m(1," S\u1ED1 l\u01B0\u1EE3ng h\xE0ng t\u1ED1i \u0111a kh\xF4ng \u0111\u01B0\u1EE3c \u0111\u1EC3 tr\u1ED1ng. "),r())}function te(i,l){if(i&1&&(a(0,"div"),u(1,ee,2,0,"div",12),r()),i&2){let d=p();c(),s("ngIf",d.showError("slotAmount","required"))}}function ie(i,l){i&1&&(a(0,"div",13),m(1," Ph\u01B0\u01A1ng th\u1EE9c thanh to\xE1n kh\xF4ng \u0111\u01B0\u1EE3c \u0111\u1EC3 tr\u1ED1ng. "),r())}function ne(i,l){if(i&1&&(a(0,"div"),u(1,ie,2,0,"div",12),r()),i&2){let d=p();c(),s("ngIf",d.showError("paymentMethodIds","required"))}}function oe(i,l){if(i&1){let d=_();a(0,"div",14)(1,"button",15),y("click",function(){E(d);let e=p();return g(e.onCreate())}),h(2,"i",16),m(3," Thi\u1EBFt l\u1EADp "),r()()}}function ae(i,l){if(i&1){let d=_();a(0,"div",14)(1,"button",15),y("click",function(){E(d);let e=p();return g(e.onUpdate())}),h(2,"i",16),m(3," C\u1EADp nh\u1EADt "),r(),a(4,"button",17),y("click",function(){E(d);let e=p();return g(e.onCopy())}),h(5,"i",18),m(6," Sao ch\xE9p "),r()()}}var ye=(()=>{let l=class l{constructor(t,e,n,o,X,z,H,J){this.fb=t,this.route=e,this.router=n,this.spinner=o,this.toast=X,this.deviceService=z,this.paymentMethodService=H,this.modalService=J,this.action="CREATE",this.paymentMethodList=[],this.locationList=[]}ngOnInit(){this.route.params.subscribe(t=>{this.deviceId=t.id,console.log(t,this.deviceId)}),this.formSave=this.fb.group({name:["",[S.required]],location:["",[S.required]],slotAmount:["",[S.required]],paymentMethodIds:["",[S.required]]}),this.router.url.includes("/update/")&&(this.action="UPDATE",this.getDeviceById(this.deviceId)),this.getAllPaymentMethod(),this.locationList=f.LOCATION}getAllPaymentMethod(){this.spinner.show(),this.paymentMethodService.getAllPaymentMethod().subscribe(t=>{this.spinner.hide(),t&&t.status&&t.status.code==f.STATUS.SUCCESS&&(t.data.forEach(e=>{e.value=e.name,e.key=e.id}),this.paymentMethodList=t.data,console.log("data payment method: ",this.paymentMethodList))})}getDeviceById(t){this.spinner.show(),this.deviceService.getDeviceById(t).subscribe(e=>{if(this.spinner.hide(),e&&e.status&&e.status.code==f.STATUS.SUCCESS){let n=this.locationList.find(o=>o.value=e.data.locationText);this.formSave.patchValue({name:e.data.name,location:n.key,slotAmount:e.data.slotAmount,paymentMethodIds:this.joinPaymentMethodId(e.data.paymentMethods)})}console.log("data devices detail: ",e)})}joinPaymentMethodId(t){return t&&t.length>0?t.map(e=>e.id):[]}onCreate(){if(this.formSave.invalid){this.formSave.markAllAsTouched(),this.formSave.markAsDirty(),this.formSave.updateValueAndValidity();return}let t=this.formSave.value,e=this.locationList.find(o=>o.key===t.location),n={name:t.name,slotAmount:t.slotAmount,paymentMethodIds:t.paymentMethodIds,locationText:e.value,locationGeo:e.locationGeo,rowAmount:5};this.spinner.show(),this.deviceService.createDevice(n).subscribe(o=>{this.spinner.hide(),console.log("res create device: ",o),o&&o.status&&o.status.code==f.STATUS.SUCCESS?this.toast.success("Th\xEAm m\u1EDBi thi\u1EBFt b\u1ECB th\xE0nh c\xF4ng!","Th\xF4ng B\xE1o"):this.toast.error("C\xF3 l\u1ED7i trong qu\xE1 tr\xECnh x\u1EED l\xFD, xin vui l\xF2ng th\u1EF1c hi\u1EC7n l\u1EA1i!","Th\xF4ng B\xE1o")}),console.log("form device",t)}onUpdate(){if(this.formSave.invalid){this.formSave.markAllAsTouched(),this.formSave.markAsDirty(),this.formSave.updateValueAndValidity();return}let t=this.formSave.value,e=this.locationList.find(o=>o.key===t.location),n={name:t.name,slotAmount:t.slotAmount,paymentMethodIds:t.paymentMethodIds,locationText:e.value,locationGeo:e.locationGeo,rowAmount:5,status:"ACTIVE"};this.spinner.show(),this.deviceService.updateDevice(n,this.deviceId).subscribe(o=>{this.spinner.hide(),console.log("res create device: ",o),o&&o.status&&o.status.code==f.STATUS.SUCCESS?this.toast.success("C\u1EADp nh\u1EADt thi\u1EBFt b\u1ECB th\xE0nh c\xF4ng!","Th\xF4ng B\xE1o"):this.toast.error("C\xF3 l\u1ED7i trong qu\xE1 tr\xECnh x\u1EED l\xFD, xin vui l\xF2ng th\u1EF1c hi\u1EC7n l\u1EA1i!","Th\xF4ng B\xE1o")}),console.log("form save update",this.formSave.value)}onCopy(){this.modalService.open(j,{title:"X\xE1c nh\u1EADn",message:"B\u1EA1n c\xF3 ch\u1EAFc mu\u1ED1n sao ch\xE9p thi\u1EBFt b\u1ECB?"}).componentInstance.confirmed.subscribe(e=>{e&&this.Copy()})}Copy(){if(this.formSave.invalid){this.formSave.markAllAsTouched(),this.formSave.markAsDirty(),this.formSave.updateValueAndValidity();return}let t=this.formSave.value,e=this.locationList.find(o=>o.key===t.location),n={name:t.name,slotAmount:t.slotAmount,paymentMethodIds:t.paymentMethodIds,locationText:e.value,locationGeo:e.locationGeo,rowAmount:5};this.spinner.show(),this.deviceService.createDevice(n).subscribe(o=>{this.spinner.hide(),console.log("res create device: ",o),o&&o.status&&o.status.code==f.STATUS.SUCCESS?this.toast.success("Sao ch\xE9p thi\u1EBFt b\u1ECB th\xE0nh c\xF4ng!","Th\xF4ng B\xE1o"):this.toast.error("C\xF3 l\u1ED7i trong qu\xE1 tr\xECnh x\u1EED l\xFD, xin vui l\xF2ng th\u1EF1c hi\u1EC7n l\u1EA1i!","Th\xF4ng B\xE1o")}),console.log("form device",t)}validField(t){let e=this.formSave.get(t);return e.invalid&&(e.dirty||e.touched)}showError(t,e){let n=this.formSave.get(t);return n.hasError(e)&&n.touched}};l.\u0275fac=function(e){return new(e||l)(v(U),v(b),v(I),v(D),v(G),v(q),v(R),v(O))},l.\u0275cmp=A({type:l,selectors:[["app-save-device"]],standalone:!0,features:[T],decls:32,vars:19,consts:[[1,"align-items-center",3,"formGroup"],[4,"ngIf"],[1,"row"],[1,"col-md-2","col-sm-4","col-xs-12","mt-3"],[1,"form-label","col-form-label"],[1,"col-md-4","col-sm-8","col-xs-12","mt-3"],["formControlName","name","maxlength","500",1,"form-control"],["formControlName","location",3,"searchable","multiple","items"],["formControlName","slotAmount","appOnlyNumber","","maxlength","5",1,"form-control"],["formControlName","paymentMethodIds",3,"searchable","multiple","items"],[1,"row","mt-3"],["class","col-12 text-center",4,"ngIf"],["class","error-message",4,"ngIf"],[1,"error-message"],[1,"col-12","text-center"],["type","button",1,"btn","btn-primary-custom","ml-20",3,"click"],[1,"fa","fa-plus"],["type","button",1,"btn","btn-primary","ml-20",3,"click"],[1,"fa","fa-copy"]],template:function(e,n){e&1&&(a(0,"div",0),u(1,K,2,0,"h4",1)(2,Q,2,0,"h4",1),a(3,"div",2)(4,"div",3)(5,"label",4),m(6," T\xEAn m\xE1y"),r()(),a(7,"div",5),h(8,"input",6),u(9,Y,2,1,"div",1),r(),a(10,"div",3)(11,"label",4),m(12," \u0110\u1ECBa \u0111i\u1EC3m"),r()(),a(13,"div",5),h(14,"app-selection",7),u(15,$,2,1,"div",1),r()(),a(16,"div",2)(17,"div",3)(18,"label",4),m(19,"S\u1ED1 l\u01B0\u1EE3ng h\xE0ng t\u1ED1i \u0111a"),r()(),a(20,"div",5),h(21,"input",8),u(22,te,2,1,"div",1),r(),a(23,"div",3)(24,"label",4),m(25," Ph\u01B0\u01A1ng th\u1EE9c thanh to\xE1n"),r()(),a(26,"div",5),h(27,"app-selection",9),u(28,ne,2,1,"div",1),r()(),a(29,"div",10),u(30,oe,4,0,"div",11)(31,ae,7,0,"div",11),r()()),e&2&&(s("formGroup",n.formSave),c(),s("ngIf",n.action==="CREATE"),c(),s("ngIf",n.action==="UPDATE"),c(6),C("is-invalid",n.validField("name")),c(),s("ngIf",n.validField("name")),c(5),s("searchable",!0)("multiple",!1)("items",n.locationList),c(),s("ngIf",n.validField("location")),c(6),C("is-invalid",n.validField("slotAmount")),c(),s("ngIf",n.validField("slotAmount")),c(5),s("searchable",!0)("multiple",!0)("items",n.paymentMethodList),c(),s("ngIf",n.validField("paymentMethodIds")),c(2),s("ngIf",n.action==="CREATE"),c(),s("ngIf",n.action==="UPDATE"))},dependencies:[P,L,M,B,w,F,k,V,x,N]});let i=l;return i})();export{ye as SaveDeviceComponent};
