import{a as Y}from"./chunk-FFKZRMDL.js";import{a as X}from"./chunk-B5M6CCOG.js";import{a as Q}from"./chunk-NBDY2TBX.js";import{a as W}from"./chunk-OPDTKCI5.js";import{a as K}from"./chunk-G55IM4YV.js";import"./chunk-BKZFVQBW.js";import{a as J}from"./chunk-CI3TO52C.js";import{a as S}from"./chunk-ZJO5XFAT.js";import{c as j,d as p,e as B,f as G,k as q,l as O,m as M,n as R,s as z,t as $,u as H}from"./chunk-3AEYLFKI.js";import{a as k}from"./chunk-HNKJNLW6.js";import{b as L,d as V}from"./chunk-TN45MXFT.js";import"./chunk-4C57YJA5.js";import{Ab as P,Bc as F,Cb as N,Cc as U,Fb as _,Gb as C,Ma as A,Qa as m,Qb as c,Ra as h,Sc as D,Yb as w,kb as f,la as b,lb as E,mb as l,va as I,wa as x,wb as n,xb as r,yb as v,zb as T}from"./chunk-ZFL4TBTD.js";import"./chunk-4L4RMVSS.js";function te(o,s){o&1&&(n(0,"h4"),c(1,"Ch\u1EC9nh s\u1EEDa campaign gi\xE1"),r())}function ie(o,s){o&1&&(n(0,"div",20),c(1," T\xEAn campaign kh\xF4ng \u0111\u01B0\u1EE3c \u0111\u1EC3 tr\u1ED1ng. "),r())}function ne(o,s){if(o&1&&(n(0,"div"),f(1,ie,2,0,"div",19),r()),o&2){let g=C();m(),l("ngIf",g.showError("name","required"))}}function re(o,s){if(o&1&&v(0,"img",28),o&2){let g,e=C().$implicit;l("src",(g=e.get("image"))==null?null:g.value,A)}}function ae(o,s){o&1&&(n(0,"div",20),c(1," Chi\u1EBFt kh\u1EA5u(%) kh\xF4ng \u0111\u01B0\u1EE3c \u0111\u1EC3 tr\u1ED1ng. "),r())}function oe(o,s){o&1&&(n(0,"div",20),c(1," Gi\xE1 hi\u1EC3n th\u1ECB kh\xF4ng \u0111\u01B0\u1EE3c \u0111\u1EC3 tr\u1ED1ng. "),r())}function me(o,s){if(o&1&&(n(0,"tr",21)(1,"td",22),v(2,"input",23),r(),n(3,"td",24),f(4,re,1,1,"img",25),r(),n(5,"td",22),v(6,"input",26),f(7,ae,2,0,"div",19),r(),n(8,"td",22),v(9,"input",27),f(10,oe,2,0,"div",19),r()()),o&2){let g,e=s.$implicit,t=s.index,i=C();l("formGroupName",t),m(),l("width","25%"),m(),E("disabled",!0),m(),l("width","25%"),m(),l("ngIf",(g=e.get("image"))==null?null:g.value),m(),l("width","25%"),m(2),l("ngIf",i.showErrorArray("items",t,"discountPercent","required")),m(),l("width","25%"),m(2),l("ngIf",i.showErrorArray("items",t,"displayPrice","required"))}}function le(o,s){if(o&1){let g=N();n(0,"div",29)(1,"button",30),_("click",function(){I(g);let t=C();return x(t.onCreate())}),v(2,"i",31),c(3," C\u1EADp nh\u1EADt "),r()()}}var be=(()=>{let s=class s{constructor(e,t,i,u,a,d,y,Z,ee){this.fb=e,this.route=t,this.router=i,this.sanitizer=u,this.itemService=a,this.deviceService=d,this.spinnerService=y,this.toastr=Z,this.priceCampaignService=ee,this.action="CREATE",this.inmageUpdate="",this.itemList=[],this.locationList=[],this.deviceList=[],this.campaignList=[]}ngOnInit(){this.route.params.subscribe(e=>{let t=e.id;console.log(e,t)}),this.formSave=this.fb.group({id:[""],name:["",[p.required]],locationText:[""],deviceIds:[""],status:[""],itemId:[""],deviceNames:[""],items:this.fb.array([])}),this.getAlldevice(),this.getAllItems(),this.getAllPriceCampaigns(),this.locationList=S.LOCATION}getAllPriceCampaigns(){this.priceCampaignService.getAllPriceCampaign().subscribe(e=>{console.log("res all device: ",e),e&&e.status&&e.status.code==S.STATUS.SUCCESS&&(e.data.forEach(t=>{t.value=t.name,t.key=t.id}),this.campaignList=e.data)})}getAllItems(){this.itemService.getAllItem().subscribe(e=>{console.log("item res: ",e),e&&e.status&&e.status.code===S.STATUS.SUCCESS&&e.data&&e.data.length>0&&(e.data.forEach(t=>{t.value=t.name,t.key=t.id}),this.itemList=e.data.filter(t=>t.status===S.ITEM_STATUS.ACTIVE))},e=>{})}getAlldevice(){this.spinnerService.show(),this.deviceService.getAllDevice().subscribe(e=>{console.log("res all device: ",e),this.spinnerService.hide(),e&&e.status&&e.status.code==S.STATUS.SUCCESS&&(e.data.forEach(t=>{t.value=t.name,t.key=t.id}),this.deviceList=e.data)})}get items(){return this.formSave.get("items")}addItem(e){let t=this.fb.group({itemId:[e.id,p.required],displayPrice:["",[p.required]],discountPercent:["",[p.required,p.min(0),p.max(100)]],discountPrice:[""],itemName:[e.name],image:[e.image]});this.items.push(t)}onChangeCampaign(e){console.log("choose campaignId",e);let t=this.campaignList.find(a=>a.id===e);this.formSave.patchValue(t),console.log("choose campaign",t,this.formSave.value);let i=this.deviceList.filter(a=>a.priceCampaign&&a.priceCampaign.id===e);if(console.log("device: ",i),i&&i.length>0){let a=i.map(d=>d.name);console.log("deviceNames: ",a),this.formSave.patchValue({deviceNames:a.length>2?`${a.slice(0,2).join(", ")} ...`:a.join(", "),deviceIds:i.map(d=>d.id)})}let u=this.formSave.get("items");u.clear(),t.items.forEach(a=>{let d=this.itemList.find(y=>y.id===a.itemId);u.push(this.fb.group({itemId:[a.itemId],displayPrice:[a.displayPrice,p.required],discountPrice:[a.discountPrice],discountPercent:[a.discountPercent,[p.required,p.min(0),p.max(100)]],itemName:[d?d.name:""],image:[d?d.image:""]}))}),console.log("choose campaign",t,this.formSave.value)}onAddItem(){let e=this.formSave.get("itemId").value;if(!e){this.toastr.warning("B\u1EA1n ch\u01B0a ch\u1ECDn m\u1EB7t h\xE0ng! ","Th\xF4ng b\xE1o");return}let t=this.formSave.get("items").value;if(t&&t.length>0&&t.find(a=>a.itemId===e)){this.toastr.warning("M\u1EB7t h\xE0ng \u0111\xE3 \u0111\u01B0\u1EE3c l\u1EF1a ch\u1ECDn tr\xEAn danh s\xE1ch! ","Th\xF4ng b\xE1o");return}let i=this.itemList.find(u=>u.id===e);this.addItem(i)}onCreate(){if(console.log(this.formSave.value),this.formSave.invalid){this.formSave.markAllAsTouched(),this.formSave.markAsDirty(),this.formSave.updateValueAndValidity();return}let e=this.formSave.value,t={name:e.name||"Holiday Discount",items:e.items.map(i=>({itemId:i.itemId,displayPrice:i.displayPrice?parseFloat(i.displayPrice):0,discountPercent:i.discountPercent?parseFloat(i.discountPercent):0})),deviceIds:e.deviceIds,status:"ACTIVE"};console.log("body  updates campaign: ",t),this.spinnerService.show(),this.priceCampaignService.updatePriceCampaign(t,e.id).subscribe(i=>{this.spinnerService.hide(),console.log("reponse create campaign",i),i&&i.status&&i.status.code==S.STATUS.SUCCESS?this.toastr.success("C\u1EADp nh\u1EADt campaign gi\xE1 th\xE0nh c\xF4ng!","Th\xF4ng b\xE1o"):this.toastr.error("C\u1EADp nh\u1EADt campaign gi\xE1 th\u1EA5t b\u1EA1i!","Th\xF4ng b\xE1o")},i=>{this.spinnerService.hide()})}onCopy(){console.log(this.formSave.value)}validField(e){let t=this.formSave.get(e);return t.invalid&&(t.dirty||t.touched)}showError(e,t){let i=this.formSave.get(e);return i.hasError(t)&&i.touched}showErrorArray(e,t,i,u){let a=this.formSave.get(e);if(!a)return!1;let d=a.at(t)?.get(i);return d?d.hasError(u)&&d.touched:!1}};s.\u0275fac=function(t){return new(t||s)(h(z),h(L),h(V),h(D),h(X),h(K),h(k),h(W),h(Y))},s.\u0275cmp=b({type:s,selectors:[["update-save-price-campaign"]],standalone:!0,features:[w],decls:51,vars:11,consts:[[4,"ngIf"],[1,"from",3,"formGroup"],[1,"row","mt-5"],[1,"col-md-2","col-sm-4","col-xs-12"],[1,"form-label","col-form-label"],[1,"col-md-4","col-sm-8","col-xs-12"],["formControlName","locationText",3,"onChangeValue","searchable","multiple","items"],["formControlName","id","readonly","",1,"form-control"],["formControlName","name",1,"form-control"],[1,"row","row","mt-3"],["formControlName","status","readonly","",1,"form-control"],["formControlName","deviceNames","readonly","",1,"form-control"],[1,"mt-3"],[1,"table-responsive","radius-table",2,"width","100%!important"],[1,"table","table-striped","table-hover"],["formArrayName","items"],[3,"formGroupName",4,"ngFor","ngForOf"],[1,"row"],["class","col-12 text-center mt-3",4,"ngIf"],["class","error-message",4,"ngIf"],[1,"error-message"],[3,"formGroupName"],[1,"min-width-cl",3,"width"],["type","text","formControlName","itemName","readonly","",1,"form-control"],[1,"min-width-cl","text-center",3,"width"],["alt","","style","width: 100px; height: 100px",3,"src",4,"ngIf"],["type","text","formControlName","discountPercent","appOnlyNumber","",1,"form-control"],["type","text","formControlName","displayPrice","appOnlyNumber","",1,"form-control"],["alt","",2,"width","100px","height","100px",3,"src"],[1,"col-12","text-center","mt-3"],["type","button",1,"btn","btn-primary-custom","ml-20",3,"click"],[1,"fa","fa-plus"]],template:function(t,i){t&1&&(n(0,"div"),f(1,te,2,0,"h4",0),n(2,"div",1)(3,"div",2)(4,"div",3)(5,"label",4),c(6," T\xEAn campaign"),r()(),n(7,"div",5)(8,"app-selection",6),_("onChangeValue",function(a){return i.onChangeCampaign(a)}),r()()(),n(9,"div",2)(10,"div",3)(11,"label",4),c(12," ID"),r()(),n(13,"div",5),v(14,"input",7),r(),n(15,"div",3)(16,"label",4),c(17," T\xEAn campaign"),r()(),n(18,"div",5),v(19,"input",8),f(20,ne,2,1,"div",0),r()(),n(21,"div",9)(22,"div",3)(23,"label",4),c(24," Tr\u1EA1ng th\xE1i"),r()(),n(25,"div",5),v(26,"input",10),r(),n(27,"div",3)(28,"label",4),c(29," T\xEAn m\xE1y"),r()(),n(30,"div",5),v(31,"input",11),r()(),n(32,"h5",12),c(33,"Danh s\xE1ch m\u1EB7t h\xE0ng"),r(),n(34,"div",13)(35,"table",14)(36,"thead")(37,"tr")(38,"th"),c(39,"M\u1EB7t h\xE0ng"),r(),n(40,"th"),c(41,"H\xECnh \u1EA3nh"),r(),n(42,"th"),c(43,"Chi\u1EBFt kh\u1EA5u(%)"),r(),n(44,"th"),c(45,"Gi\xE1 hi\u1EC3n th\u1ECB"),r()()(),n(46,"tbody"),T(47,15),f(48,me,11,9,"tr",16),P(),r()()(),n(49,"div",17),f(50,le,4,0,"div",18),r()()()),t&2&&(m(),l("ngIf",i.action==="CREATE"),m(),l("formGroup",i.formSave),m(6),l("searchable",!0)("multiple",!1)("items",i.campaignList),m(6),E("disabled",!0),m(6),l("ngIf",i.validField("name")),m(6),E("disabled",!0),m(5),E("disabled",!0),m(17),l("ngForOf",i.items.controls),m(2),l("ngIf",i.action==="CREATE"))},dependencies:[$,j,B,G,H,q,R,O,M,J,U,F,Q]});let o=s;return o})();export{be as UpdatePriceCampaignComponent};
