import{a as W}from"./chunk-FFKZRMDL.js";import{a as Q}from"./chunk-B5M6CCOG.js";import{a as J}from"./chunk-NBDY2TBX.js";import{a as K}from"./chunk-OPDTKCI5.js";import{a as $}from"./chunk-G55IM4YV.js";import"./chunk-BKZFVQBW.js";import{a as H}from"./chunk-CI3TO52C.js";import{a as S}from"./chunk-ZJO5XFAT.js";import{c as L,d as v,e as q,f as G,k as U,l as j,m as O,n as V,s as M,t as R,u as z}from"./chunk-3AEYLFKI.js";import{a as B}from"./chunk-HNKJNLW6.js";import{b as D,d as k}from"./chunk-TN45MXFT.js";import"./chunk-4C57YJA5.js";import{Ab as T,Bc as P,Cb as A,Cc as F,Fb as C,Gb as g,Ma as b,Qa as m,Qb as c,Ra as p,Sc as N,Yb as w,kb as d,la as _,mb as o,va as y,wa as I,wb as n,xb as r,yb as u,zb as x}from"./chunk-ZFL4TBTD.js";import"./chunk-4L4RMVSS.js";function ee(a,l){a&1&&(n(0,"h4"),c(1,"Th\xEAm m\u1EDBi campaign gi\xE1"),r())}function te(a,l){a&1&&(n(0,"div",22),c(1," T\xEAn campaign kh\xF4ng \u0111\u01B0\u1EE3c \u0111\u1EC3 tr\u1ED1ng. "),r())}function ie(a,l){if(a&1&&(n(0,"div"),d(1,te,2,0,"div",21),r()),a&2){let s=g();m(),o("ngIf",s.showError("name","required"))}}function ne(a,l){a&1&&(n(0,"div",22),c(1," T\xEAn m\xE1y kh\xF4ng \u0111\u01B0\u1EE3c \u0111\u1EC3 tr\u1ED1ng. "),r())}function re(a,l){if(a&1&&(n(0,"div"),d(1,ne,2,0,"div",21),r()),a&2){let s=g();m(),o("ngIf",s.showError("deviceIds","required"))}}function ae(a,l){if(a&1&&u(0,"img",30),a&2){let s,e=g().$implicit;o("src",(s=e.get("image"))==null?null:s.value,b)}}function oe(a,l){a&1&&(n(0,"div",22),c(1," Chi\u1EBFt kh\u1EA5u(%) kh\xF4ng \u0111\u01B0\u1EE3c \u0111\u1EC3 tr\u1ED1ng. "),r())}function me(a,l){a&1&&(n(0,"div",22),c(1," Gi\xE1 hi\u1EC3n th\u1ECB kh\xF4ng \u0111\u01B0\u1EE3c \u0111\u1EC3 tr\u1ED1ng. "),r())}function le(a,l){if(a&1&&(n(0,"tr",23)(1,"td",24),u(2,"input",25),r(),n(3,"td",26),d(4,ae,1,1,"img",27),r(),n(5,"td",24),u(6,"input",28),d(7,oe,2,0,"div",21),r(),n(8,"td",24),u(9,"input",29),d(10,me,2,0,"div",21),r()()),a&2){let s,e=l.$implicit,t=l.index,i=g();o("formGroupName",t),m(),o("width","25%"),m(),o("disabled",!0),m(),o("width","25%"),m(),o("ngIf",(s=e.get("image"))==null?null:s.value),m(),o("width","25%"),m(2),o("ngIf",i.showErrorArray("items",t,"discountPercent","required")),m(),o("width","25%"),m(2),o("ngIf",i.showErrorArray("items",t,"displayPrice","required"))}}function ce(a,l){if(a&1){let s=A();n(0,"div",31)(1,"button",32),C("click",function(){y(s);let t=g();return I(t.onCreate())}),u(2,"i",33),c(3," Th\xEAm m\u1EDBi "),r()()}}var be=(()=>{let l=class l{constructor(e,t,i,h,f,E,X,Y,Z){this.fb=e,this.route=t,this.router=i,this.sanitizer=h,this.itemService=f,this.deviceService=E,this.spinnerService=X,this.toastr=Y,this.priceCampaignSerive=Z,this.action="CREATE",this.inmageUpdate="",this.itemList=[],this.locationList=[],this.deviceList=[]}ngOnInit(){this.route.params.subscribe(e=>{let t=e.id;console.log(e,t)}),this.formSave=this.fb.group({name:["",[v.required]],locationText:[""],deviceIds:["",[v.required]],itemId:[""],items:this.fb.array([])}),this.getAllItems(),this.getAlldevice(),this.locationList=S.LOCATION}getAllItems(){this.spinnerService.show(),this.itemService.getAllItem().subscribe(e=>{console.log("item res: ",e),this.spinnerService.hide(),e&&e.status&&e.status.code===S.STATUS.SUCCESS&&e.data&&e.data.length>0&&(e.data.forEach(t=>{t.value=t.name,t.key=t.id}),this.itemList=e.data.filter(t=>t.status===S.ITEM_STATUS.ACTIVE))},e=>{this.spinnerService.hide()})}getAlldevice(){this.spinnerService.show(),this.deviceService.getAllDevice().subscribe(e=>{console.log("res all device: ",e),this.spinnerService.hide(),e&&e.status&&e.status.code==S.STATUS.SUCCESS&&(e.data.forEach(t=>{t.value=t.name,t.key=t.id}),this.deviceList=e.data)})}get items(){return this.formSave.get("items")}addItem(e){let t=this.fb.group({itemId:[e.id,v.required],displayPrice:["",[v.required]],discountPercent:["",[v.required,v.min(0),v.max(100)]],discountPrice:[""],itemName:[e.name],image:[e.image]});this.items.push(t)}onAddItem(){let e=this.formSave.get("itemId").value;if(!e){this.toastr.warning("B\u1EA1n ch\u01B0a ch\u1ECDn m\u1EB7t h\xE0ng! ","Th\xF4ng b\xE1o");return}let t=this.formSave.get("items").value;if(t&&t.length>0&&t.find(f=>f.itemId===e)){this.toastr.warning("M\u1EB7t h\xE0ng \u0111\xE3 \u0111\u01B0\u1EE3c l\u1EF1a ch\u1ECDn tr\xEAn danh s\xE1ch! ","Th\xF4ng b\xE1o");return}let i=this.itemList.find(h=>h.id===e);this.addItem(i)}onCreate(){if(console.log(this.formSave.value),this.formSave.invalid){this.formSave.markAllAsTouched(),this.formSave.markAsDirty(),this.formSave.updateValueAndValidity();return}let e=this.formSave.value,t={name:e.name||"Holiday Discount",items:e.items.map(i=>({itemId:i.itemId,displayPrice:i.displayPrice?parseFloat(i.displayPrice):0,discountPercent:i.discountPercent?parseFloat(i.discountPercent):0})),deviceIds:e.deviceIds};console.log("body  create campaign: ",t),this.spinnerService.show(),this.priceCampaignSerive.createPriceCampaign(t).subscribe(i=>{this.spinnerService.hide(),console.log("reponse create campaign",i),i&&i.status&&i.status.code==S.STATUS.SUCCESS?this.toastr.success("Th\xEAm m\u1EDBi campaign gi\xE1 th\xE0nh c\xF4ng!","Th\xF4ng b\xE1o"):this.toastr.error("Th\xEAm m\u1EDBi campaign gi\xE1 th\u1EA5t b\u1EA1i!","Th\xF4ng b\xE1o")},i=>{this.spinnerService.hide()})}onUpdate(){console.log(this.formSave.value)}validField(e){let t=this.formSave.get(e);return t.invalid&&(t.dirty||t.touched)}showError(e,t){let i=this.formSave.get(e);return i.hasError(t)&&i.touched}showErrorArray(e,t,i,h){let f=this.formSave.get(e);if(!f)return!1;let E=f.at(t)?.get(i);return E?E.hasError(h)&&E.touched:!1}};l.\u0275fac=function(t){return new(t||l)(p(M),p(D),p(k),p(N),p(Q),p($),p(B),p(K),p(W))},l.\u0275cmp=_({type:l,selectors:[["app-save-price-campaign"]],standalone:!0,features:[w],decls:48,vars:15,consts:[[4,"ngIf"],[1,"from",3,"formGroup"],[1,"row","mt-5"],[1,"col-md-2","col-sm-4","col-xs-12"],[1,"form-label","col-form-label"],[1,"col-md-4","col-sm-8","col-xs-12"],["formControlName","name",1,"form-control"],["formControlName","locationText",3,"searchable","multiple","items"],[1,"row","row","mt-3"],["formControlName","deviceIds",3,"searchable","multiple","items"],[1,"mt-3"],[1,"table-responsive","radius-table",2,"width","100%!important"],[1,"table","table-striped","table-hover"],["formArrayName","items"],[3,"formGroupName",4,"ngFor","ngForOf"],[1,"col-md-2","col-sm-4","col-xs-12",2,"display","flex","align-items","center"],[1,"cursor-pointer","hover-color-red","font-size-18","color-black",3,"click"],[1,"fa","fa-pencil-square-o"],["formControlName","itemId",3,"searchable","multiple","items"],[1,"row"],["class","col-12 text-center mt-3",4,"ngIf"],["class","error-message",4,"ngIf"],[1,"error-message"],[3,"formGroupName"],[1,"min-width-cl",3,"width"],["type","text","formControlName","itemName",1,"form-control",3,"disabled"],[1,"min-width-cl","text-center",3,"width"],["alt","","style","width: 100px; height: 100px",3,"src",4,"ngIf"],["type","text","formControlName","discountPercent","appOnlyNumber","",1,"form-control"],["type","text","formControlName","displayPrice","appOnlyNumber","",1,"form-control"],["alt","",2,"width","100px","height","100px",3,"src"],[1,"col-12","text-center","mt-3"],["type","button",1,"btn","btn-primary-custom","ml-20",3,"click"],[1,"fa","fa-plus"]],template:function(t,i){t&1&&(n(0,"div"),d(1,ee,2,0,"h4",0),n(2,"div",1)(3,"div",2)(4,"div",3)(5,"label",4),c(6," T\xEAn campaign"),r()(),n(7,"div",5),u(8,"input",6),d(9,ie,2,1,"div",0),r(),n(10,"div",3)(11,"label",4),c(12," \u0110\u1ECBa \u0111i\u1EC3m"),r()(),n(13,"div",5),u(14,"app-selection",7),r()(),n(15,"div",8)(16,"div",3)(17,"label",4),c(18," T\xEAn m\xE1y"),r()(),n(19,"div",5),u(20,"app-selection",9),d(21,re,2,1,"div",0),r()(),n(22,"h5",10),c(23,"Danh s\xE1ch m\u1EB7t h\xE0ng"),r(),n(24,"div",11)(25,"table",12)(26,"thead")(27,"tr")(28,"th"),c(29,"M\u1EB7t h\xE0ng"),r(),n(30,"th"),c(31,"H\xECnh \u1EA3nh"),r(),n(32,"th"),c(33,"Chi\u1EBFt kh\u1EA5u(%)"),r(),n(34,"th"),c(35,"Gi\xE1 hi\u1EC3n th\u1ECB"),r()()(),n(36,"tbody"),x(37,13),d(38,le,11,9,"tr",14),T(),r()()(),n(39,"div",2)(40,"div",15)(41,"a",16),C("click",function(){return i.onAddItem()}),n(42,"i",17),c(43," Th\xEAm m\u1EB7t h\xE0ng"),r()()(),n(44,"div",3),u(45,"app-selection",18),r()(),n(46,"div",19),d(47,ce,4,0,"div",20),r()()()),t&2&&(m(),o("ngIf",i.action==="CREATE"),m(),o("formGroup",i.formSave),m(7),o("ngIf",i.validField("name")),m(5),o("searchable",!0)("multiple",!0)("items",i.locationList),m(6),o("searchable",!0)("multiple",!0)("items",i.deviceList),m(),o("ngIf",i.validField("deviceIds")),m(17),o("ngForOf",i.items.controls),m(7),o("searchable",!0)("multiple",!1)("items",i.itemList),m(2),o("ngIf",i.action==="CREATE"))},dependencies:[R,L,q,G,z,U,V,j,O,H,F,P,J]});let a=l;return a})();export{be as SavePriceCampaignComponent};
